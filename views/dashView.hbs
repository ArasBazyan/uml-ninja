<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>


    <style>
        body {
            font-family: Avenir, sans-serif !important;
            background: whitesmoke;
        }

        /* Left column */
        .leftcolumn {
            padding: 16px;
            float: right;
            width: 30%;
            height:100%;
        }

        /* Right column */
        .rightcolumn {
            padding: 16px;
            float: right;
            width: 70%;
        }

        .card {
            border: 1px solid #e3e3e3;
            background-color: white;
            padding: 15px;
            margin-top: 10px;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        /* Responsive design */
        @media screen and (max-width: 700px) {
            .leftcolumn, .rightcolumn {
                width: 100%;
                padding: 0;
            }
        }


        .btn{
            margin-top: 15px;
        }

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .jumbotron{
            padding: 15px; !important;
        }

    </style>

</head>
<body>

<div id="main" class="container-fluid">
    <div class="row content">
        <div class="col-sm-12">
            <div style="margin-bottom: 0; margin-top: 10px"  class="well">
                <h3> Dashboard </h3>
                <p> Information about repository <b>{{ data.ProjectName }}</b></p>
                <p> Number of contributors: <b> {{  data.Contributers }} </p></b>
                <p> Github API link: <b><a href="{{ data.ProjectUrl }}">{{ data.ProjectUrl }}</a> </p></b>
            </div>


            <!-- MODAL TO ADD NEW ANALYZER
            <div class="modal fade" id="addAnalyzerModal" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Add Analyzer</h4>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <label class="col-form-label">Analyzer Name</label>
                                    <input type="text" class="form-control" id="analyzer-name">
                                </div>
                                <div class="form-group">
                                    <label for="message-text" class="col-form-label">Threshold</label>
                                    <input type="text" class="form-control" id="threshold-number">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="saveAnalyzer" data-dismiss="modal">Save changes</button>
                        </div>
                    </div>

                </div>
            </div>




            <!-- MODAL TO ADD NEW THREASHOLD
            <div class="modal fade" id="addThreasholdModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Add New Threashold</h4>
                        </div>
                        <div class="modal-body">
                            <p>Some text</p>
                            <form>
                                <div class="form-group">
                                    <label class="col-form-label">Documentation Process</label>
                                    <input type="text" class="form-control" id="dpThreashold">
                                </div>
                                <div class="form-group">
                                    <label for="message-text" class="col-form-label">UML Threashold</label>
                                    <input type="text" class="form-control" id="umlThreashold">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="applyThreashold" data-dismiss="modal">Save changes</button>
                        </div>
                    </div>
                </div>
            </div> -->



            <!-- MODAL - Commit Ratio Detail-->
            <div class="modal fade" id="commit-ratio" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Commit Ratio</h4>
                        </div>
                        <div class="modal-body">
                            <div id="chartContainer" style="height: 370px; width: 100%;"></div>
                            <br>
                            <br>
                            <h4 id="commitRatio" >Commit Ratio </h4>
                        </div>
                        <div class="modal-footer">
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL - Doc Evolution Detail-->
            <div class="modal fade" id="doc-evolution" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Document Evolution</h4>
                        </div>
                        <div class="modal-body">
                            <div id="docChartContainer" style="height: 370px; width: 100%;"></div>
                            <br>
                            <br>
                            <h4 id="docEvolution"> Doc. size ratio to UML commits </h4>
                        </div>
                        <div class="modal-footer">
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Documentation Process Results -->
                <div class="rightcolumn">
                    <div class="card">
                        <h3> Documentation Process </h3>
                        <div class="row marketing">
                            <div class="jumbotron">
                                <div class="table-responsive">
                                    <table id="process-table" class="table tablesorter">
                                        <thead>
                                        <tr>
                                            <th><h4>Level up</h4></th>
                                            <th class="col-md-5"><h4>Level</h4></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>
                                                <a href="/uml-commit-ratio/">UML Commit Ratio</a>
                                            </td>

                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-warning" data-toggle="modal" data-target="#commit-ratio" id="commit_ratio" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="3" style="cursor:pointer;  width: 100%">
                                                        <span class="levelSpan"><strong>2/3</strong></span>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <a href="/doc-evolution/">Document Evolution</a>
                                            </td>
                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-danger" data-toggle="modal" data-target="#doc-evolution" id="doc_evolution" role="progressbar" aria-valuenow="1" aria-valuemin="0" aria-valuemax="3" style="width: 33%">
                                                        <span class="docLevelSpan" ><strong>1/3</strong></span>
                                                    </div>
                                                    <div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>




                    <!-- UML Content Results NISH NISH -->
                    <div class="card">
                        <h3> UML Content</h3>
                        <h5>Description</h5>
                        <p id="docEvolution">AvsC</p>
                        <p id="docEvolution">ASvsC</p>
                        <p id="docEvolution">MEvsC</p>
                        <p id="docEvolution">APPM</p>

                        <div id="chartContainerLine" style="height: 370px; width: 100%;"></div>
                    </div>
                </div>

                <div class="leftcolumn">
                    <div style="min-height: 483px" class="card">
                        <div>
                            <img src="/img/ninja.png"  class="center" alt=ninja.png height="150" width="150">
                        </div>


                        <h3 id="score">Score
                            <div style="float: right">
                            <a style="width: 100%; margin-top: 50%; float: right; font-size:0" href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="Score of UML Documentation Practices in my project " data-hashtags="UMLninja" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                            </div>
                        </h3>
                        <!--
                        <i id="levelIcon" class="material-icons" style="font-size:60px; margin: 15px 34%;">sentiment_very_satisfied</i>
                        -->

                        <br>
                        <a id="umlBestPractices" target="_blank" href="https://bellekens.com/uml-best-practices/">UML Best Practices </a>
                    </div>

                </div>

                <div class="rightcolumn">
                    <div class="card">
                        <h3> EXTRA :  Documentation Process </h3>
                        <h5> Document Size: <b> {{data.DocumenSize}}Mb </b></h5>
                        <div id="chartContainer" style="height: 370px; width: 100%;"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>


    //Define table header
    function createTableHeader(arrayHeader,elementId){
        const thead = document.createElement("THEAD");
        const tr = document.createElement("TR");
        for(let i = 0; i < arrayHeader.length; i++){
            let th = document.createElement("TH");
            let text = document.createTextNode(arrayHeader[i]);

            th.appendChild(text);
            tr.appendChild(th);
        }
        thead.appendChild(tr);
        document.getElementById(elementId).appendChild(thead);
    }

    function insertTableData(headerLength, arrayTablesData, elementId){
        const tablesDataKeys = Object.keys(arrayTablesData[0]);
        const tbody = document.createElement("TBODY");

        for(let i = 0; i < arrayTablesData.length; i++){
            let tr = document.createElement("TR");
            for(let j = 1; j < headerLength+1; j++){
                let tableData = arrayTablesData[i];
                let td = document.createElement("TD");
                let text = document.createTextNode(tableData[tablesDataKeys[j]]);

                 td.appendChild(text);

                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        }
        document.getElementById(elementId).appendChild(tbody);
    }

    insertTableData(2, "indicatro and its level array" , "process-table");






    //Update level number. Stop for now
function updateLevel(span, level) {
        var levelSpan = $('.'+span);
        levelSpan.html(level + '/' + 5);
}
updateLevel('docLevelSpan' , 4);




    /* Global variables used to manipulate UI views */
    var score = 0;
    var commitRatio = 30;
    var umlThreasholdDef = 50;
    var dpThreasholdDef = 50;
    var levelIcon = $("#levelIcon");
    var levelIconDeffaultText = "error_outline";




    /* End of GLobal variable section */

    allData = {
        idProject : {{ data.idProject }},
        projectName : "{{data.ProjectName}}",
        projectURL : "{{ data.ProjectUrl }}",
        contributors : {{ data.Contributers }},
        documentName : "{{ data.DocumentName }}",
        allCommits : {{ data.NumberOfCommits }},
        umlCommits : {{ data.UMLCommits }},
        docSize : {{ data.DocumenSize }}

    };

    temp = [];
    //push all data in array for when it's needed
    temp.push(allData);
    console.log(temp);


    /* RATIO VALUES */
    var commitRatio = allData.umlCommits / allData.allCommits;
    var docSize = allData.docSize;
    var documentEvolution = allData.docSize / allData.umlCommits;

    console.log("Project ID  " + allData.idProject);



    // create graphs
    window.onload = function() {
        var dataPointsLine = [];
        var dataPointsLine2 = [];
        var dataPointsPie = [];
        var dataPointsDoc = [];

        temp.forEach( function (arrayItem)
        {
            //data for uml commits
            dataPointsPie.push({y: arrayItem.allCommits , name : "All Commits" });
            dataPointsPie.push({y: arrayItem.umlCommits , name : "UML Commits" });

            // data for  doc evolution
            dataPointsDoc.push({y: arrayItem.docSize , label : "Document Size, in MB" });
            dataPointsDoc.push({y: arrayItem.umlCommits , label : "Number of UML Commits" });
        });

        var chart = new CanvasJS.Chart("chartContainer", {
            exportEnabled: true,
            animationEnabled: true,
            title: {
                text: "All Commits vs. UML Commits"
            },
            theme: "theme2",
            legend: {
                cursor : "pointer",
                itemclick: explodePie
            },
            data: [{
                type: "doughnut",
                showInLegend: true,
                startAngle: 240,
                percentFormatString: "#0.##",
                toolTipContent: "{y}",
                yValueFormatString: "##0 Commits",
                indexLabel: "#percent%",
                dataPoints: dataPointsPie

            }]
        });
        chart.render();
        commitRatio = commitRatio * 100;
        $('#commitRatio').html("Commit ratio: " + commitRatio.toFixed(2).bold().big() + '<b>%</b>');


        //var docSizeEl = document.getElementById("docSize");
        //docSizeEl.innerHTML = "doc Size:  " + docSize.toFixed(1).bold().big();










    // Another way to get alldata, as an array
    var arrayData = [];
    arrayData.push({{ data.idProject }});
    arrayData.push("{{ data.ProjectName }}");
    arrayData.push("{{ data.ProjectUrl }}");
    arrayData.push({{ data.Contributers }});
    arrayData.push("{{ data.DocumentName }}");
    arrayData.push({{ data.NumberOfCommits }});
    arrayData.push({{ data.UMLCommits }});
    arrayData.push({{ data.DocumenSize }});



    var docChart = new CanvasJS.Chart("docChartContainer", {
        exportEnabled: true,
        animationEnabled: true,
        title: {
            text: "All Commits vs. UML Commits"
        },
        theme: "theme2",
        legend: {
            cursor : "pointer",
            itemclick: explodePie
        },
        data: [{
            type: "column",
            startAngle: 240,
            dataPoints: dataPointsDoc

        }]
    });
    $('#docEvolution').html("Document Evolution: " + documentEvolution.toFixed(3).bold().big());
    docChart.render();







    //From Canvasjs
    function explodePie (e) {
        if(typeof (e.dataSeries.dataPoints[e.dataPointIndex].exploded) === "undefined" || !e.dataSeries.dataPoints[e.dataPointIndex].exploded) {
            e.dataSeries.dataPoints[e.dataPointIndex].exploded = true;
        } else {
            e.dataSeries.dataPoints[e.dataPointIndex].exploded = false;
        }
        e.chart.render();

    }


} // end of OnLoad



    /* OLD stuff. Remove later

        var dataPoints = [];

    var chart = new CanvasJS.Chart("chartContainer", {
      animationEnabled: true,
      theme: "light2",
      title: {
        text: "Some other graph"
      },
      axisY: {
        title: "Units",
        titleFontSize: 24
      },
      data: [{
        type: "spline",
        yValueFormatString: "#,### Units",
        dataPoints: dataPoints
      }]
    });

    function addData(data) {
        console.log("BEFORE " + data.length);
      for (var i = 0; i < data.length; i++) {
        console.log(data.length);
        console.log(data[i].NumberOfCommits)
        console.log(data[i].UMLCommits);
        dataPoints.push({
          x: data[i].Total_Commits,
          y: data[i].Total_Commits
        });
      }
      chart.render();

    }

    $.getJSON("/data.json", addData);




    // Lined Chart
        var dataPointsLine = [];
        var dataPointsLine2 = [];
        $.getJSON("/data.json", function(data) {
            $.each(data, function(key, value){
                console.log("LEEEE  " + value["Doc Commits"].length);
                dataPointsLine.push({x: value.Total_Commits, y: value["Doc Commits"].length  });
                dataPointsLine2.push({x: value["Doc Commits"].length , y:  value.Total_Commits });

            });
            var chart = new CanvasJS.Chart("chartContainerLine",{
                animationEnabled: true,
                zoomEnabled: true,
                theme: "light2",
                title:{
                    text:"UML commit history"
                },
                axisX: {
                    title: "UML Commits",
                    titleFontSize: 24
                },
                axisY: {
                    title: "Commit Frequency",
                    titleFontSize: 24
                },
                data: [
                    {
                        type: "spline",
                        dataPoints : dataPointsLine,
                    },
                    {
                        type: "spline",
                        dataPoints : dataPointsLine2,
                    }

                ]
            });
            chart.render();
        });


    */


    var scoreEl = $('#score').html("Score: " + score + '/' + 30);
</script>

<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
</body>
</html>